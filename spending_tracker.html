<!doctype html>
<!-- https://github.com/twbs/examples/blob/main/starter/index.html -->
<html lang="en"> 
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Spending Tracker</title> 
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
        <script src="./spending_tracker_script.js"></script>
    </head> 
    <body>
        <div class="container my-5">
          <h1>Spending Tracker</h1>
          <div class="col-lg-8 px-0">
            <p class="fs-5">Welcome to Spending Tracker where you can track your monthly spending!</p>

            <hr class="col-8 my-4">

          </div>

          <div>
            <button class="btn btn-primary" id="button-getAll" onclick="showTable()">Show All Spending</button><br/><br/>
          </div>

          <div class="dropdown">  <!-- https://getbootstrap.com/docs/5.3/components/dropdowns/ -->
            <button class="btn btn-primary dropdown-toggle" id="button-getMonthly" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                Show Monthly Spending
            </button><br/><br/>
            <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">January</a></li>
                <li><a class="dropdown-item" href="#">February</a></li>
                <li><a class="dropdown-item" href="#">March</a></li>
                <li><a class="dropdown-item" href="#">April</a></li>
                <li><a class="dropdown-item" href="#">May</a></li>
                <li><a class="dropdown-item" href="#">June</a></li>
                <li><a class="dropdown-item" href="#">July</a></li>
                <li><a class="dropdown-item" href="#">August</a></li>
                <li><a class="dropdown-item" href="#">September</a></li>
                <li><a class="dropdown-item" href="#">October</a></li>
                <li><a class="dropdown-item" href="#">November</a></li>
                <li><a class="dropdown-item" href="#">December</a></li>
            </ul>
          </div>

          <div>
            <input type="text" id="tableSearch" onkeyup="searchTable()" placeholder="Search table.." title="Start typing">
          </div>

          <div>
            <table class="table" id="spendingTable" style="display: none;">
                <thead>
                    <tr>
                        <th scope="col">Id</th>
                        <th scope="col">Date</th>
                        <th scope="col">Description</th>
                        <th scope="col">Tag</th>
                        <th scope="col">Cost</th>
                        <th scope="col">Update</th>
                        <th scope="col">Delete</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
          </div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js" integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO" crossorigin="anonymous"></script>
    </body>
    <script>
        // Function to show all spending on button click
        // https://how.dev/answers/how-to-display-a-table-on-button-click-in-javascript
        document.getElementById("button-getAll").addEventListener("click", function showTable() {
            var table = document.getElementById("spendingTable");
            if (table.style.display === "none" || table.style.display === "") {
                table.style.display = "table"; // Show the table if it's hidden
                getAll(processGetAllResponse)
            } else {
                table.style.display = "none"; // Hide the table if it's visible
                clearTable();
            }
        });
        // Function to clear the table
        // https://codeforgeek.com/remove-all-rows-from-table-in-javascript/
        function clearTable() {
            const tableBody = document.querySelector('#spendingTable tbody');
 
            // Loop through rows and remove them
            while (tableBody.firstChild) {
                tableBody.removeChild(tableBody.firstChild);
            }
        }
        // Function to filter table in search bar
        //https://www.w3schools.com/howto/howto_js_filter_table.asp
        //https://hakk.dev/blog/posts/html-table-filter/
        function searchTable() {
            var input, filter, table, tr, td, i, txtValue;
            input = document.getElementById("tableSearch");
            filter = input.value.toUpperCase();
            table = document.getElementById("spendingTable");
            tr = table.getElementsByTagName("tr");
            for (i = 0; i < tr.length; i++) {
              td = tr[i].getElementsByTagName("td");
              for (var j = 0; j < td.length; j++) {
                txtValue = td[j].textContent || td[j].innerText;
                  if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    tr[i].style.display = "";
                    break;
                  } else {
                    tr[i].style.display = "none";
                  }
                }
            }
        }
        function addExpenseToTable(expense){
            // Add data rows to body of table
            // https://stackoverflow.com/a/18333693
            var tableElement = document.getElementById('spendingTable').getElementsByTagName('tbody')[0]
            var rowElement = tableElement.insertRow(-1)
            
            rowElement.setAttribute('id',expense.id)
            
            var cell1 = rowElement.insertCell(0);
            cell1.innerHTML = expense.id
            var cell2 = rowElement.insertCell(1);
            cell2.innerHTML = expense.date
            var cell3 = rowElement.insertCell(2);
            cell3.innerHTML = expense.description
            var cell4 = rowElement.insertCell(3);
            cell4.innerHTML = expense.tag_name
            var cell5 = rowElement.insertCell(4);
            cell5.innerHTML = expense.cost
            var cell6 = rowElement.insertCell(5);
            cell6.innerHTML = '<button class="btn btn-secondary" onclick="showUpdate(this)">Update</button>'
            var cell7 = rowElement.insertCell(6);
            cell7.innerHTML = '<button class="btn btn-secondary" onclick=doDelete(this)>Delete</button>'

        }
        // populate the table
        function processGetAllResponse(result){
            console.log("in process")
            for (expense of result){
                displayExpense = {}
                displayExpense.id = expense.id
                displayExpense.date = expense.date.split(" 00:")[0] //https://www.geeksforgeeks.org/how-to-remove-time-from-date-using-javascript/
                displayExpense.description = expense.description
                displayExpense.tag_name = expense.tag_name
                displayExpense.cost = expense.cost.toFixed(2) //https://www.w3schools.com/js/js_number_methods.asp
                addExpenseToTable(displayExpense)
            }
        }
    </script> 
</html> 